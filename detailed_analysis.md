# ุชูุฑูุฑ ุงูุชุญููู ุงูุชูุตููู ููุดุฑูุน Love

## ุชุงุฑูุฎ ุงูุชุญููู
**ุงูุชุงุฑูุฎ:** 6 ููููุจุฑ 2025 - 02:45 ุตุจุงุญุงู (GMT+3)

---

## 1. ููุฎุต ุงูุจููุฉ ุงูุชูููุฉ

### Frontend (ุงููุงุฌูุฉ ุงูุฃูุงููุฉ)
- **ุงูููุตุฉ:** Vercel
- **Framework:** React 19 + Vite 7
- **UI Library:** Tailwind CSS + Radix UI
- **State Management:** React Hooks + Local Storage
- **ุงููููุน:** `/frontend/`

### Backend (ุงููุงุฌูุฉ ุงูุฎูููุฉ)
- **ูุงุนุฏุฉ ุงูุจูุงูุงุช:** Supabase (PostgreSQL)
- **API Layer:** Vercel Serverless Functions
- **ุงููููุน:** `/api/`
- **Runtime:** Node.js 22

### ุงูุงุชุตุงู
- **Frontend โ Supabase:** ูุจุงุดุฑ ุนุจุฑ `@supabase/supabase-js`
- **Frontend โ Vercel API:** ุนุจุฑ `/api/v1/*` endpoints
- **Vercel API โ Supabase:** ูุจุงุดุฑ ุนุจุฑ `@supabase/supabase-js`

---

## 2. ุงูุฌุฏุงูู ุงูููุฌูุฏุฉ ูู Supabase

### โ ุงูุฌุฏุงูู ุงูุนุงููุฉ

| ุงุณู ุงูุฌุฏูู | ุงูุญุงูุฉ | ุงูุฃุนูุฏุฉ | ุงูุงุณุชุฎุฏุงู |
|------------|--------|---------|-----------|
| `patients` | โ ูุนูู | id, gender, created_at, last_active | ุชุฎุฒูู ุจูุงูุงุช ุงููุฑุถู |
| `clinics` | โ ูุนูู | id, name_ar, name_en, pin, is_active, requires_pin, display_order, created_at, updated_at, pin_code | ุฅุฏุงุฑุฉ ุงูุนูุงุฏุงุช |
| `queues` | โ ูุนูู | (ูุงุฑุบ ุญุงููุงู) | ุฅุฏุงุฑุฉ ุงูุทูุงุจูุฑ |
| `pathways` | โ ูุนูู | id, patient_id, gender, pathway, current_step, completed, created_at, updated_at | ุงููุณุงุฑุงุช ุงูุทุจูุฉ |
| `admin_users` | โ ูุนูู | id, username, password, role, name, email, is_active, last_login, created_at, updated_at | ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู |
| `notifications` | โ ูุนูู | id, patient_id, message, type, read, created_at | ูุธุงู ุงูุฅุดุนุงุฑุงุช |

### โ ุงูุฌุฏุงูู ุบูุฑ ุงูููุฌูุฏุฉ

- `queue_entries` (ุชู ุฐูุฑู ูู ุจุนุถ ุงูุฃููุงุฏ ุงููุฏููุฉ)
- `exam_types` (ุบูุฑ ููุฌูุฏ)
- `exams` (ุบูุฑ ููุฌูุฏ)
- `routes` (ุบูุฑ ููุฌูุฏ)
- `pins` (ุบูุฑ ููุฌูุฏ)
- `settings` (ุบูุฑ ููุฌูุฏ)
- `logs` (ุบูุฑ ููุฌูุฏ)
- `events` (ุบูุฑ ููุฌูุฏ)

---

## 3. ุชุญููู API Endpoints

### API Endpoints ุงูููุฌูุฏุฉ

#### 1. `/api/v1/patients/login`
- **ุงูููู:** `/api/v1/patients/login.ts`
- **ุงูููุน:** Vercel Serverless Function
- **ุงููุธููุฉ:** ุชุณุฌูู ุฏุฎูู/ุชุณุฌูู ุงููุฑุถู
- **ุงูุงุชุตุงู:** ูุจุงุดุฑ ูุน Supabase
- **ุงูุฌุฏูู:** `patients`
- **ุงููุชุบูุฑุงุช ุงููุทููุจุฉ:**
  - `VITE_SUPABASE_URL` ุฃู `SUPABASE_URL`
  - `VITE_SUPABASE_ANON_KEY` ุฃู `SUPABASE_ANON_KEY`
- **ุงูุญุงูุฉ:** โ ูุฌุจ ุฃู ูุนูู

#### 2. `/api/v1/queue/status`
- **ุงูููู:** `/api/v1/queue/status.ts`
- **ุงูููุน:** Proxy Function
- **ุงููุธููุฉ:** ุชูุฌูู ุงูุทูุจุงุช ุฅูู API ุฎุงุฑุฌู
- **ุงููุชุบูุฑุงุช ุงููุทููุจุฉ:**
  - `API_ORIGIN` (ูุทููุจ)
- **ุงูุญุงูุฉ:** โ๏ธ ูุญุชุงุฌ ุฅูู ุชุนููู `API_ORIGIN`

#### 3. `/api/v1/health/status`
- **ุงูููู:** `/api/v1/health/status.ts`
- **ุงูููุน:** Health Check
- **ุงูุญุงูุฉ:** โ๏ธ ูุญุชุงุฌ ุฅูู ูุญุต

#### 4. `/api/v1/events/stream`
- **ุงูููู:** `/api/v1/events/stream.ts`
- **ุงูููุน:** Edge Function (SSE)
- **ุงููุชุบูุฑุงุช ุงููุทููุจุฉ:**
  - `API_ORIGIN`
  - `CORS_ALLOW_ORIGIN`
- **ุงูุญุงูุฉ:** โ๏ธ ูุญุชุงุฌ ุฅูู ุชุนููู ุงููุชุบูุฑุงุช

#### 5. `/api/login` ู `/api/signin`
- **ุงููููุงุช:** `/api/login.ts`, `/api/signin.ts`
- **ุงูููุน:** Proxy Functions
- **ุงููุชุบูุฑุงุช ุงููุทููุจุฉ:**
  - `UPSTREAM_API_BASE`
- **ุงูุญุงูุฉ:** โ๏ธ ูุญุชุงุฌ ุฅูู ุชุนููู `UPSTREAM_API_BASE`

---

## 4. ุชุญููู Frontend

### ูุธุงู API ุงูููุญุฏ

ุงูู Frontend ูุณุชุฎุฏู ูุธุงู **Unified API** ุงูุฐู ูุฏุนู ูุถุนูู:
1. **Local Mode:** ูุณุชุฎุฏู Local Storage
2. **Supabase Mode:** ูุชุตู ูุจุงุดุฑุฉ ุจู Supabase

**ุงููุถุน ุงูุญุงูู:** `BACKEND_MODE = 'supabase'`

### ุงููููุงุช ุงูุฑุฆูุณูุฉ

#### 1. `api-unified.js`
- **ุงููุธููุฉ:** ุทุจูุฉ API ููุญุฏุฉ
- **ุงูููุฒุงุช:**
  - ุงูุชุจุฏูู ุจูู Local ู Supabase
  - ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
  - Fallback mechanism

#### 2. `supabase-client.js`
- **ุงููุธููุฉ:** ุฅูุดุงุก Supabase client
- **ุงูุฅุนุฏุงุฏุงุช:**
  - Auto refresh token
  - Persist session
  - Realtime support

#### 3. `supabase-backend-api.js`
- **ุงููุธููุฉ:** ุฌููุน ุนูููุงุช Supabase
- **ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ:**
  - `patientLogin()`
  - `createPathway()`
  - `enterQueue()`
  - `getQueueStatus()`
  - `queueDone()`
  - `getPinStatus()`

---

## 5. ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ ุงููุทููุจุฉ

### Frontend (Vercel)

```env
VITE_SUPABASE_URL=https://utgsoizsnqchiduzffxo.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
VITE_APP_URL=https://love.vercel.app
```

### API (Vercel Serverless Functions)

```env
# Supabase Connection
SUPABASE_URL=https://utgsoizsnqchiduzffxo.supabase.co
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
VITE_SUPABASE_URL=https://utgsoizsnqchiduzffxo.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# API Proxy (ุฅุฐุง ูุงู ููุงู API ุฎุงุฑุฌู)
API_ORIGIN=https://api.example.com
UPSTREAM_API_BASE=https://api.example.com

# CORS
CORS_ALLOW_ORIGIN=*
```

---

## 6. ุงููุดุงูู ุงูููุชุดูุฉ ูุงูุญููู

### ูุดููุฉ 1: ูุชุบูุฑุงุช ุงูุจูุฆุฉ ุบูุฑ ููุชููุฉ

**ุงููุตู:** ุจุนุถ API endpoints ุชุนุชูุฏ ุนูู ูุชุบูุฑุงุช ุจูุฆุฉ ุบูุฑ ูุนุฑูุฉ

**ุงููุชุบูุฑุงุช ุงูููููุฏุฉ:**
- `API_ORIGIN` (ูุณุชุฎุฏู ูู proxy.ts ู stream.ts)
- `UPSTREAM_API_BASE` (ูุณุชุฎุฏู ูู login.ts ู signin.ts)
- `CORS_ALLOW_ORIGIN` (ูุณุชุฎุฏู ูู cors.ts ู stream.ts)

**ุงูุญู:**
1. ุฅุฐุง ูุงู ุงููุดุฑูุน ูุณุชุฎุฏู API ุฎุงุฑุฌูุ ูุฌุจ ุชุนููู `API_ORIGIN`
2. ุฅุฐุง ูุงู ุงููุดุฑูุน ูุนุชูุฏ ููุท ุนูู Supabaseุ ูููู ุฅุฒุงูุฉ proxy endpoints
3. ุชุนููู `CORS_ALLOW_ORIGIN` ููุณูุงุญ ุจุงูุทูุจุงุช ูู Frontend

**ุงูุชูุตูุฉ:**
```env
# ุฅุฐุง ูู ููู ููุงู API ุฎุงุฑุฌู
API_ORIGIN=https://utgsoizsnqchiduzffxo.supabase.co
UPSTREAM_API_BASE=https://utgsoizsnqchiduzffxo.supabase.co
CORS_ALLOW_ORIGIN=https://love.vercel.app,http://localhost:5173
```

### ูุดููุฉ 2: ุฌุฏูู `queues` ูุงุฑุบ

**ุงููุตู:** ุฌุฏูู `queues` ููุฌูุฏ ูููู ูุงุฑุบ

**ุงูุชุฃุซูุฑ:**
- ูุธุงู ุงูุทูุงุจูุฑ ูุฏ ูุง ูุนูู ุจุดูู ุตุญูุญ
- ูุง ุชูุฌุฏ ุจูุงูุงุช ููุงุฎุชุจุงุฑ

**ุงูุญู:**
1. ูุญุต ุจููุฉ ุงูุฌุฏูู (ุงูุฃุนูุฏุฉ)
2. ุฅูุดุงุก ุจูุงูุงุช ุงุฎุชุจุงุฑูุฉ
3. ุงูุชุฃูุฏ ูู ุฃู ุงูููุฏ ูุฏุฎู ุงูุจูุงูุงุช ุจุดูู ุตุญูุญ

### ูุดููุฉ 3: ุนุฏู ูุฌูุฏ ููู .env ูู Frontend

**ุงููุตู:** Frontend ูุง ูุญุชูู ุนูู ููู `.env`

**ุงูุชุฃุซูุฑ:**
- ูุนุชูุฏ ุนูู ุงูููู ุงูุงูุชุฑุงุถูุฉ ุงูููุชูุจุฉ ูู ุงูููุฏ
- ุตุนูุจุฉ ูู ุชุบููุฑ ุงูุฅุนุฏุงุฏุงุช

**ุงูุญู:**
โ ุชู ุฅูุดุงุก ููู `.env` ูู `/frontend/.env`

---

## 7. ุชุฏูู ุงูุจูุงูุงุช ุงูุญุงูู

### ุณููุงุฑูู 1: ุชุณุฌูู ุฏุฎูู ุงููุฑูุถ

```
1. ุงููุฑูุถ ูุฏุฎู ุงูุจูุงูุงุช ูู LoginPage.jsx
   โ
2. ูุชู ุงุณุชุฏุนุงุก api-unified.patientLogin()
   โ
3. ูุชู ุชูุฌูู ุงูุทูุจ ุฅูู supabase-backend-api.patientLogin()
   โ
4. ูุชู ุงูุงุชุตุงู ุจู Supabase ูุจุงุดุฑุฉ
   โ
5. ูุชู ุงูุชุญูู ูู ูุฌูุฏ ุงููุฑูุถ ูู ุฌุฏูู patients
   โ
6. ุฅุฐุง ููุฌูุฏ: ุชุญุฏูุซ last_active
   ุฅุฐุง ุบูุฑ ููุฌูุฏ: ุฅูุดุงุก ุณุฌู ุฌุฏูุฏ
   โ
7. ุฅูุดุงุก pathway ูููุฑูุถ ูู ุฌุฏูู pathways
   โ
8. ุฅุฑุฌุงุน ุงูุจูุงูุงุช ุฅูู Frontend
```

### ุณููุงุฑูู 2: ุงูุฏุฎูู ูู ุงูุทุงุจูุฑ

```
1. ุงููุฑูุถ ูุฎุชุงุฑ ุงูุนูุงุฏุฉ
   โ
2. ูุชู ุงุณุชุฏุนุงุก api-unified.enterQueue()
   โ
3. ูุชู ุชูุฌูู ุงูุทูุจ ุฅูู supabase-backend-api.enterQueue()
   โ
4. ูุชู ุงูุงุชุตุงู ุจู Supabase
   โ
5. ูุชู ุฅุฏุฎุงู ุณุฌู ุฌุฏูุฏ ูู ุฌุฏูู queues
   โ
6. ูุชู ุญุณุงุจ ุงููููุน ูู ุงูุทุงุจูุฑ
   โ
7. ุฅุฑุฌุงุน ุฑูู ุงูุฏูุฑ ูุงููููุน ุฅูู Frontend
```

---

## 8. ุงูุฎุทูุงุช ุงูุชุงููุฉ

### ุงููุฑุญูุฉ ุงูุญุงููุฉ: ุชุญููู ุงูุจููุฉ โ

### ุงููุฑุญูุฉ ุงููุงุฏูุฉ: ุงุฎุชุจุงุฑ API Endpoints

**ุงูุฃูุฏุงู:**
1. ุงุฎุชุจุงุฑ `/api/v1/patients/login`
2. ุงุฎุชุจุงุฑ `/api/v1/queue/status`
3. ุงุฎุชุจุงุฑ `/api/v1/health/status`
4. ูุญุต ุจููุฉ ุฌุฏูู `queues`
5. ุงุฎุชุจุงุฑ ุนูููุงุช ุงูุฅุฏุฎุงู ูุงูุงุณุชุนูุงู

### ุงููุฑุญูุฉ ุงูุซุงูุซุฉ: ุชูุซูู ุงููุดุงูู

**ุงูุฃูุฏุงู:**
1. ุชูุซูู ุฌููุน ุงููุดุงูู ุงูููุชุดูุฉ
2. ุฅูุดุงุก ุฎุทุฉ ุฅุตูุงุญ ููุตูุฉ
3. ุชุญุฏูุฏ ุงูุฃููููุงุช

### ุงููุฑุญูุฉ ุงูุฑุงุจุนุฉ: ุงูุฅุตูุงุญ

**ุงูุฃูุฏุงู:**
1. ุชุนููู ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ ูู Vercel
2. ุฅุตูุงุญ ุฃู ุฃุฎุทุงุก ูู ุงูููุฏ
3. ุงุฎุชุจุงุฑ ุฌููุน ุงููุธุงุฆู
4. ูุดุฑ ุงูุชุญุฏูุซุงุช

---

## 9. ููุงุญุธุงุช ูููุฉ

### โ ุงูููุงุท ุงูุฅูุฌุงุจูุฉ

1. **ุงูุงุชุตุงู ุจู Supabase ูุนูู ุจุดูู ุตุญูุญ**
2. **ุงูุฌุฏุงูู ุงูุฑุฆูุณูุฉ ููุฌูุฏุฉ ูุชุนูู**
3. **ุงูุจููุฉ ุงูุชูููุฉ ูุงุถุญุฉ ูููุธูุฉ**
4. **ุงูููุฏ ูุณุชุฎุฏู best practices**
5. **ูุธุงู API ููุญุฏ ููุฑู**

### โ๏ธ ุงูููุงุท ุงูุชู ุชุญุชุงุฌ ุฅูู ุงูุชุจุงู

1. **ูุชุบูุฑุงุช ุงูุจูุฆุฉ ุบูุฑ ููุชููุฉ**
2. **ุฌุฏูู queues ูุงุฑุบ**
3. **ุจุนุถ API endpoints ุชุนุชูุฏ ุนูู API ุฎุงุฑุฌู ุบูุฑ ูุงุถุญ**
4. **ูุง ุชูุฌุฏ ุจูุงูุงุช ุงุฎุชุจุงุฑูุฉ**

### ๐ ููุงุท ุชุญุชุงุฌ ุฅูู ุชูุถูุญ

1. **ูู ููุงู API ุฎุงุฑุฌูุ** (API_ORIGIN)
2. **ูุง ูู UPSTREAM_API_BASEุ**
3. **ูู ูุธุงู ุงูุทูุงุจูุฑ ูุนูู ุญุงููุงูุ**
4. **ูุง ูู ุงูุจูุงูุงุช ุงููุชููุนุฉ ูู ุฌุฏูู queuesุ**

---

**ุชู ุฅูุดุงุก ูุฐุง ุงูุชูุฑูุฑ ุจูุงุณุทุฉ:** Manus AI  
**ุงูุชุงุฑูุฎ:** 6 ููููุจุฑ 2025 - 02:45 ุตุจุงุญุงู (GMT+3)
