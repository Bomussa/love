# Middleware V2.1 - ุงูุทุจูุฉ ุงููุณุทูุฉ ุงูุฐููุฉ

**ุงููุณุฎุฉ**: 2.1.0  
**ุงูุชุงุฑูุฎ**: 2025-10-23  
**ุงูุญุงูุฉ**: โ ุฌุงูุฒ ููุฅูุชุงุฌ

---

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุฐู ุงูุทุจูุฉ ุงููุณุทูุฉ ููุณุช ูุฌุฑุฏ ูุณูุท ุทูุจ/ุฑุฏุ ุจู **ูุธุงู ุนุตุจู** ูุชูุงูู ูููู ุจู:

- โ ุงุณุชูุจุงู ูู ุญุฏุซ ูู ุงููุงุฌูุฉ
- โ ุงูุชุญูู ุงูููุฑู ุนุจุฑ `validation-engine`
- โ ุงูุชุตุญูุญ ุงูุฐุงุชู ุนุจุฑ `auto-repair`
- โ ุงูุงุชุตุงู ุงููุญุธู ูุน Backend
- โ ุงูุจุซ ุงููุจุงุดุฑ ููุฅุฏุงุฑุฉ ุนุจุฑ `realtime.service`

---

## ๐๏ธ ุงููููู

\`\`\`
/middleware
โ
โโโ core/                    # ุงููุญุฑู ุงููุฑูุฒู
โ   โโโ engine.js           # ุงููุญุฑู ุงูุฐูู ุงูุฑุฆูุณู
โ   โโโ validation-engine.js # ุงูุชุญูู ุงููุชูุงูู
โ   โโโ orchestration.js    # ุชูุณูู ุงูุฃุญุฏุงุซ
โ   โโโ auto-repair.js      # ุงูุชุตุญูุญ ุงูุฐุงุชู
โ   โโโ rules.js            # ุงูููุงุนุฏ ุงูุซุงุจุชุฉ
โ   โโโ constants.js        # ุงูุซูุงุจุช ุงูููููุฉ
โ
โโโ handlers/                # ูุนุงูุฌุงุช ุงูุทูุจุงุช
โ   โโโ pin.handler.js
โ   โโโ session.handler.js
โ   โโโ queue.handler.js
โ   โโโ log.handler.js
โ   โโโ notification.handler.js
โ   โโโ fix.handler.js
โ
โโโ services/                # ุงูุฎุฏูุงุช ุงูุฎุงุฑุฌูุฉ
โ   โโโ backend.service.js  # ุงูุงุชุตุงู ุจุงููBackend
โ   โโโ db.service.js       # ูุงุนุฏุฉ ุงูุจูุงูุงุช
โ   โโโ realtime.service.js # ุงูุจุซ ุงููุญุธู
โ   โโโ health.service.js   # ุงูุตุญุฉ ูุงููุฑุงูุจุฉ
โ
โโโ guards/                  # ุงูุญุฑุงุณ ุงูุฃููููู
โ   โโโ conflict.guard.js   # ููุน ุงูุชุนุงุฑุถุงุช
โ   โโโ timing.guard.js     # ุงูุชุณูุณู ุงูุฒููู
โ   โโโ security.guard.js   # ุงูุฃูุงู
โ
โโโ utils/                   # ุงูุฃุฏูุงุช ุงููุณุงุนุฏุฉ
โ   โโโ logger.js           # ุงูุชุณุฌูู
โ   โโโ formatter.js        # ุงูุชูุณูู
โ   โโโ metrics.js          # ุงูุฅุญุตุงุฆูุงุช
โ
โโโ routes/                  # ุงููุณุงุฑุงุช
โ   โโโ pin.routes.js
โ   โโโ session.routes.js
โ   โโโ queue.routes.js
โ   โโโ notification.routes.js
โ   โโโ admin.routes.js
โ   โโโ router.js           # ุงูููุฌู ุงููุฑูุฒู
โ
โโโ monitor/                 # ุงููุฑุงูุจุฉ ูุงูุชุนุงูู
โ   โโโ watcher.js          # ุงููุฑุงูุจุฉ
โ   โโโ audit-log.js        # ุงูุณุฌู
โ   โโโ recovery.js         # ุงูุชุนุงูู
โ
โโโ index.js                 # ููุทุฉ ุงูุฏุฎูู
\`\`\`

---

## ๐ ุงูุชุดุบูู ุงููุญูู

\`\`\`bash
cd middleware
npm install
npm run dev
\`\`\`

ุงูุฎุงุฏู ุณูุนูู ุนูู ุงููููุฐ **8080** (ูุงุจู ููุชุบููุฑ).

---

## ๐ก ุงููุณุงุฑุงุช ุงููุชุงุญุฉ

| ุงููุณุงุฑ | ุงูุทุฑููุฉ | ุงููุตู |
|--------|---------|-------|
| `/mw/session/start` | POST | ุจุฏุก ุฌูุณุฉ ุฌุฏูุฏุฉ |
| `/mw/clinic/enter` | POST | ุฏุฎูู ุนูุงุฏุฉ |
| `/mw/pin/verify` | POST | ุงูุชุญูู ูู PIN |
| `/mw/queue/issue` | POST | ุฅุตุฏุงุฑ ุฑูู ุฏูุฑ |
| `/mw/admin/pins/today` | GET | ุฃููุงุฏ ุงูููู |
| `/mw/admin/live` | GET | ุงูุจุซ ุงููุจุงุดุฑ |
| `/mw/notify/info` | POST | ุฅุดุนุงุฑ |

---

## โ๏ธ ุงูููุทู ุงููุงูู

### 1. ุงูุชุฏูู ุงูุฃุณุงุณู

\`\`\`
Frontend โ routes โ handler โ guards โ engine
                                         โ
                                    validation
                                         โ
                                   orchestration
                                         โ
                                   auto-repair (ุฅู ูุฒู)
                                         โ
                                    formatter
                                         โ
                                      logger
                                         โ
                              โโโโโโโโโโโโดโโโโโโโโโโโ
                              โ                     โ
                         Backend              Realtime
                              โ                     โ
                         Database            Admin UI
\`\`\`

### 2. ููุงุท ุงูููุฉ

| ุงููุธููุฉ | ุงูููุงู | ุงูุฏูุฑ |
|---------|--------|-------|
| ููุน ุงุฒุฏูุงุฌ ุงูุฌูุณุฉ | `conflict.guard.js` | ุฑูุถ ุฌูุณุฉ ุจููุณ IP/device ุฎูุงู 24h |
| ุชุตุญูุญ ุฐุงุชู | `auto-repair.js` | ุฅุนุงุฏุฉ ุจูุงุก ุงูุทูุจ ุฎูุงู 5 ุซูุงูู |
| ูุฑุงูุจุฉ ุตุญูุฉ | `health.service.js` + `watcher.js` | ูุดู ุงูุจุทุก ูุฅุฑุณุงู ุชูุจูู |
| ุชูุซูู ูุชุณูุณู | `audit-log.js` | ูู ุนูููุฉ ุจุชูููุช ุฏููู |
| ุจุซ ุญู | `realtime.service.js` | ุฅุดุนุงุฑุงุช ูุญุธูุฉ |
| ุชุนุงูู ููุฑู | `recovery.js` | ุฅุนุงุฏุฉ ุชุดุบูู ุจุฏูู ููุฏ ุฌูุณุงุช |

---

## ๐ ุงูุฃูุงู

- โ **ูุง ูุชุงุจุฉ ูุจุงุดุฑุฉ**: ูู ุดูุก ููุฑ ุนุจุฑ Backend
- โ **ุชูุซูู ูุงูู**: ูู ุนูููุฉ ูุณุฌูุฉ
- โ **ุชุญูู ูุชุนุฏุฏ ุงูุทุจูุงุช**: Guards + Validation + Backend

---

## ๐ ุงููุฑุงูุจุฉ

ุงุณุชุฎุฏู `/mw/admin/live` ููุญุตูู ุนูู:
- ุนุฏุฏ ุงูุฌูุณุงุช ุงููุดุทุฉ
- ุฃุฑูุงู ุงูุฏูุฑ ุงููุตุฏุฑุฉ
- ุงูุฃุฎุทุงุก ูุงูุชุตุญูุญุงุช

---

## ๐๏ธ ุงูุชุทููุฑ

### ุฅุถุงูุฉ ูุณุงุฑ ุฌุฏูุฏ

1. ุฃูุดุฆ handler ูู `handlers/`
2. ุฃูุดุฆ route ูู `routes/`
3. ุฃุถู ุงููุณุงุฑ ูู `router.js`

### ุฅุถุงูุฉ ูุงุนุฏุฉ ุชุญูู

1. ุฃุถู ุงููุงุนุฏุฉ ูู `rules.js`
2. ุงุณุชุฎุฏููุง ูู `validation-engine.js`

---

## ๐ ุงูุชุฑุฎูุต

ูุฐุง ุงููุดุฑูุน ุฎุงุต ุจุชุทุจูู ุงููุฌูุฉ ุงูุทุจูุฉ.

---

**ุงููุทูุฑ**: Lead Software Architect  
**ุงูุชุงุฑูุฎ**: 2025-10-23
