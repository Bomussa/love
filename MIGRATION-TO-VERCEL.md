# MIGRATION-TO-VERCEL

هذه الخطة تنقل تشغيل التطبيق من Cloudflare إلى Vercel مع إبقاء نسخة Cloudflare جاهزة كخطة رجوع سريعة. المشروع لا يستخدم قاعدة بيانات ثقيلة، والمنطق يتم عبر طبقة وسطية (Middleware) ونقاط API خفيفة.

## 1) الهدف والنطاق
- تشغيل النسخة التجريبية/الفعّالة على Vercel الآن.
- المحافظة على نفس المسارات (/api/v1/، مسارات الواجهة) دون كسر التوافق.
- عدم استخدام قواعد بيانات خارجية أو تخزين دائم.
- فصل بيئة التجربة عن بيئة Cloudflare الحالية إلى أن يكتمل التحقق.
- قابلية رجوع فورية إلى Cloudflare خلال دقائق إذا لزم.

---

## 2) بنية المجلدات القياسية على Vercel

إذا كان المشروع واجهة (Next.js/Vite/Static) + API خفيفة:

```
/
├─ public/                 # أصول ثابتة
├─ src/                    # كود الواجهة
│  ├─ middleware/          # الطبقة الوسطية (اختياري، إن كانت مستقلة)
│  └─ ... 
├─ api/                    # Vercel Serverless/Edge Functions (نقل الـWorkers هنا)
│  └─ v1/
│     ├─ healthcheck.js
│     ├─ session-verify.js
│     ├─ queue-dispatch.js
│     └─ ...
├─ vercel.json             # توجيهات، رؤوس أمان، إعادة كتابة/توجيه
├─ package.json
└─ MIGRATION-TO-VERCEL.md  # هذا الملف
```

كل ملف داخل api/ يتحول إلى Endpoint تلقائيًا على المسار /api/....

---

## 3) الحالة الحالية

✅ **تم إنشاء البنية الأساسية:**
- مجلد `/api/v1/` جاهز
- ملف `vercel.json` موجود
- المشروع منشور على: https://love-snowy-three.vercel.app

⚠️ **ما ينقص:**
- تحويل جميع endpoints من Cloudflare Workers إلى Vercel Functions
- إعداد نظام تخزين بديل لـ KV (استخدام Vercel KV أو ملفات JSON مؤقتة)
- تحديث `vercel.json` بالمسارات والرؤوس الأمنية الكاملة

---

## 4) خطة التنفيذ

### المرحلة 1: إنشاء Vercel Functions ✅ جاري العمل
- [x] إنشاء مجلد `/api/v1/`
- [ ] تحويل جميع endpoints من `infra/mms-api/src/index.js`
- [ ] إنشاء نظام تخزين بديل (Vercel KV أو JSON files)

### المرحلة 2: تحديث vercel.json
- [ ] إضافة جميع المسارات
- [ ] إضافة رؤوس الأمان
- [ ] ضبط إعادة التوجيه

### المرحلة 3: الاختبار
- [ ] اختبار جميع endpoints
- [ ] التحقق من عمل الواجهة الأمامية
- [ ] اختبار الأداء

### المرحلة 4: النشر
- [ ] Push إلى GitHub
- [ ] التحقق من النشر التلقائي على Vercel
- [ ] اختبار البيئة الإنتاجية

---

## 5) التقدم الحالي

**تاريخ البدء:** 25 أكتوبر 2025
**الحالة:** جاري العمل - المرحلة 1

---

## 6) ملاحظات مهمة

- المشروع يستخدم Cloudflare KV للتخزين - يحتاج بديل على Vercel
- جميع endpoints تستخدم `/api/v1/` prefix
- الواجهة الأمامية تعمل بشكل صحيح
- يجب الحفاظ على نفس response format لتجنب كسر التوافق

---

**آخر تحديث:** 25 أكتوبر 2025 - 19:22 GMT+3

